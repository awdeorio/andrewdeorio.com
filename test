#!/bin/bash

# Stop on errors
set -Eeuo pipefail

# Make sure publications list is up-to-date
cp html/index.html tmp.html
./build tmp.html
if ! diff -q html/index.html tmp.html > /dev/null; then
  echo "Error: publications list is out-of-date"
  rm -f tmp.html
  exit 1
else
  echo "Publications list is up-to-date"
  rm -f tmp.html
fi

# Print commands
set -x

# Make sure copyright year is up-to-dat
YEAR=$(date '+%Y')
grep -q "&copy; ${YEAR} Andrew DeOrio" html/index.html

# Validate HTML
html5validator --root html

# Check for bad links
linkchecker \
  --check-extern \
  --timeout 10 \
  --threads 100 \
  html
